---
title: "SGA Anaylsis Pipeline"
author: "OP & PC"
date: "5/9/22"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
```

```{r load libraries}
library(dplyr)
library(ggplot2)
library(tinytex)
library(tidyverse)
library(readxl)
library(viridis)
library(ggpubr)
```


```{r read file}
raw_data <- read_excel(file.choose(), sheet = "Raw")
```

```{r, New datset}
raw_data_colnames <- raw_data
```

```{r, Replacing Special Characters}
if (length(i <- grep("\u0394", colnames(raw_data_colnames)))) {
 delta_replace <- gsub("\u0394", "del", colnames(raw_data_colnames))
}
if (length(i <- grep("\u0394", colnames(raw_data_colnames)))) {
  colnames(raw_data_colnames) <- delta_replace
}
```

```{r, second New dataset}
raw_data_blank_mean <- raw_data_colnames
```

```{r, Averaging Blanks}
raw_data_blank_mean <- raw_data_colnames %>%
  select(contains("Blank")) %>%
  colMeans(na.rm = TRUE) %>%
  round(3)
```

```{r clean data}
raw_data_clean <- raw_data_colnames %>%
  select(-`0% (Blank)`, -`50% (Blank)`, -`HI-50% (Blank)`, -`Time`)
```

## Clean Data

Here is the data after removing the background using the mean blanks for the Serum Growth Assay of 2290 WT (Wild Type), -1$\Delta$, and -2$\Delta$, in 0% serum, 50% serum, and 50% heat inactivated (HI) serum.

```{r for loop}
for (a in 1:ncol(raw_data_clean)) {
 if (grepl(" 0%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[1])
 }
 if (grepl(" 50%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[2])
 }
 if (grepl("-50%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[3])
 }
}
options(dplyr.width = Inf)
raw_data_clean
```

```{r time}
trans_data <- stack(raw_data_clean) %>%
  mutate(Time = rep(c(1,2,3,4), times = 9))
colnames(trans_data) [1:2] <- c("OD", "Sample")
```

# Plots of Cleaned Data

```{r plot 1}
zero_plot <- trans_data %>%
  filter(grepl(" 0%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "0% Serum")+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"))+
  xlim(0,4)

fifty_plot <- trans_data %>%
  filter(grepl(" 50%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "50% Serum")+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"))+
  xlim(0,4)

hi_plot <- trans_data %>%
  filter(grepl("HI-50%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "HI-50% Serum")+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"))+
  xlim(0,4)

figure_1 <- ggarrange(zero_plot, fifty_plot, hi_plot,
                    labels = c("A", "B", "C"),
                    ncol = 2, nrow = 2)
figure_1
```

Each plot shows how that serum type affected the growth of WT, -1$\Delta$, and -2$\Delta$ over a period of time in hours. Plots A, B, and C depict 0% serum, 50% serum, and 50% HI serum respectively,
