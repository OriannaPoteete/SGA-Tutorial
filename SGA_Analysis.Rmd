---
title: "SGA Analysis Pipeline"
author: "OP & PC"
date: "5/9/22"
output:
  pdf_document: 
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
```

```{r load libraries}
library(dplyr)
library(ggplot2)
library(tinytex)
library(tidyverse)
library(readxl)
library(viridis)
library(ggpubr)
library(knitr)
library(kableExtra)
```


```{r read file}
raw_data <- read_excel(file.choose(), sheet = "Raw")
```

```{r, New datset}
raw_data_colnames <- raw_data
```

```{r, Replacing Special Characters}
if (length(i <- grep("\u0394", colnames(raw_data_colnames)))) {
 delta_replace <- gsub("\u0394", "del", colnames(raw_data_colnames))
}
if (length(i <- grep("\u0394", colnames(raw_data_colnames)))) {
  colnames(raw_data_colnames) <- delta_replace
}
```

```{r, second New dataset}
raw_data_blank_mean <- raw_data_colnames
```

```{r, Averaging Blanks}
raw_data_blank_mean <- raw_data_colnames %>%
  select(contains("Blank")) %>%
  colMeans(na.rm = TRUE) %>%
  round(3)
```

```{r clean data}
raw_data_clean <- raw_data_colnames %>%
  select(-`0% (Blank)`, -`50% (Blank)`, -`HI-50% (Blank)`, -`Time`)
```

# Clean Data

Here is the data after removing the background using the mean blanks for the Serum Growth Assay of 2290 WT (Wild Type), -1$\Delta$, and -2$\Delta$, in 0% serum, 50% serum, and 50% heat inactivated (HI) serum.

```{r for loop}
for (a in 1:ncol(raw_data_clean)) {
 if (grepl(" 0%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[1])
 }
 if (grepl(" 50%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[2])
 }
 if (grepl("-50%", colnames(raw_data_clean)[a])) {
   raw_data_clean[ , a] <- raw_data_clean[ , a] - as.numeric(raw_data_blank_mean[3])
 }
}
options(dplyr.width = Inf)
raw_data_clean_t <- add_column(raw_data_clean, Time = c(1,2,3,4), .before = 1)
if (length(i <- grep("del", colnames(raw_data_clean_t)))) {
 delta_replace <- gsub("del", "\u0394", colnames(raw_data_clean_t))
}
if (length(i <- grep("del", colnames(raw_data_clean_t)))) {
  colnames(raw_data_clean_t) <- delta_replace
}
kable(raw_data_clean_t, caption = "Serum Growth Assay for GN02290", "latex", booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```

Here is the data after removing the background using the mean blanks for the Serum Growth Assay of 2290 WT (Wild Type), -1$\Delta$, and -2$\Delta$, in 0% serum, 50% serum, and 50% heat inactivated (HI) serum.

```{r time}
trans_data <- stack(raw_data_clean) %>%
  mutate(Time = rep(c(1,2,3,4), times = 9))
colnames(trans_data) [1:2] <- c("OD", "Sample")
```

# Plots of Cleaned Data

```{r plot 1}
od_600 = expression(paste(OD[600]))
my.labs <- list("WT", "ppi-1\u0394", "ppi-2\u0394")
zero_plot <- trans_data %>%
  filter(grepl(" 0%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "0% Serum", y = od_600)+
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank())+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"), labels = my.labs)+
  xlim(0,4)+
  ylim(-0.1,1)
fifty_plot <- trans_data %>%
  filter(grepl(" 50%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "50% Serum",  y = od_600)+
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank())+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"), labels = my.labs)+
  xlim(0,4)+
  ylim(-0.1,1)
hi_plot <- trans_data %>%
  filter(grepl("HI-50%", Sample)) %>%
  ggplot(aes(x = Time, color = Sample, y = OD))+
  geom_point(size = 1.5)+
  geom_line()+
  labs(title = "HI-50% Serum", y = od_600)+
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank())+
  scale_colour_manual(values = c("#c51b8a","#d95f0e","#2c7fb8"), labels = my.labs)+
  xlim(0,4)+
  ylim(-0.1,1)
figure_1 <- ggarrange(zero_plot, fifty_plot, hi_plot,
                    labels = c("A", "B", "C"),
                    ncol = 2, nrow = 2, common.legend = TRUE,legend="bottom")
annotate_figure(figure_1, top = text_grob("Serum Growth Assay for GN02290", 
               color = "black", face = "bold", size = 14))
```

GN02290 WT, ppi-1$\Delta$, and ppi-2$\Delta$ were grown in solutions of 0% Serum (Limited Media), 50% Serum (Limited Media + Serum), 50% Heat-inactivated  (HI) Serum (Limited Media + HI-Serum), and 50% C5-inhibited (C5i) Serum (Limited Media + C5i-Serum). Serum was heat-inactivated by incubating at 56^o^C for 30 minutes and stored on ice until needed. C5 was inhibited by treating the serum with Eculizumab for a few minutes before adding cells. Figure 1A shows that all isolates grew similar in Limited Media. Figure 1B shows that the WT isolates were unaffected by the addition of serum compared to the mutants. Figure 1C shows that the heat-inactivation method does inactivate serum killing. Figure 1D shows that the Eculizumab treatment did not have an effect on serum killing.
